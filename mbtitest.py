import streamlit as st
import pandas as pd
from datetime import datetime

st.set_page_config(page_title="μ •λ°€ MBTI ν…μ¤νΈ", layout="centered")
st.title("π§  μ •λ°€ MBTI ν…μ¤νΈ (28λ¬Έν•­)")
st.markdown("λ‹Ήμ‹ μ μ„±κ²©μ„ 28κ°μ μ„Έλ°€ν• μ§λ¬ΈμΌλ΅ λ¶„μ„ν•΄λ“λ¦½λ‹λ‹¤.")

# μ§λ¬Έ λ°μ΄ν„° μ •μ (κ° μ°¨μ› 7κ°μ”©)
questions = {
    "EI": [
        ("μ‚¬λλ“¤κ³Ό μ΄μ•ΌκΈ°ν•  λ• μ—λ„μ§€κ°€ μƒκΈ΄λ‹¤", "E", "I"),
        ("νν‹°λ‚ λ¨μ„μ„ μμ£Ό μ°Έμ„ν•λ” νΈμ΄λ‹¤", "E", "I"),
        ("λ§ν•κΈ°λ³΄λ‹¤λ” λ“£λ” κ²ƒμ΄ νΈν•λ‹¤", "I", "E"),
        ("νΌμ μλ” μ‹κ°„μ΄ κΌ­ ν•„μ”ν•λ‹¤", "I", "E"),
        ("μ¦‰ν¥μ μΈ λ€ν™”μ— λ¥μ™ν•λ‹¤", "E", "I"),
        ("λ§μ€ μ‚¬λλ³΄λ‹¤ μ†μμ κΉμ€ κ΄€κ³„λ¥Ό μ„ νΈν•λ‹¤", "I", "E"),
        ("λ¨λ¥΄λ” μ‚¬λκ³Όλ„ κΈλ°© μΉν•΄μ§ μ μλ‹¤", "E", "I")
    ],
    "SN": [
        ("κµ¬μ²΄μ μΈ μ„¤λ…μ„ λ” μ„ νΈν•λ‹¤", "S", "N"),
        ("μ„Έλ¶€μ μΈ μ •λ³΄λ¥Ό λ†“μΉμ§€ μ•μΌλ ¤ λ…Έλ ¥ν•λ‹¤", "S", "N"),
        ("λ―Έλμ κ°€λ¥μ„±μ„ μμ£Ό μƒμƒν•λ‹¤", "N", "S"),
        ("μ§€κΈ ν„μ‹¤λ³΄λ‹¤ 'λ¬΄μ—‡μ΄ λ  μ μλ”κ°€'λ¥Ό μƒκ°ν•λ‹¤", "N", "S"),
        ("μƒλ΅μ΄ κ°λ…μ„ λ°°μ°λ” κ²ƒμ΄ μ¦κ²λ‹¤", "N", "S"),
        ("κ°κ°μ μΌλ΅ μ²΄ν—ν• κ²ƒμ„ λ” μ‹ λΆ°ν•λ‹¤", "S", "N"),
        ("μ‚¬μ‹¤λ³΄λ‹¤ ν•΄μ„μ— λ” μ§‘μ¤‘ν•λ‹¤", "N", "S")
    ],
    "TF": [
        ("μμ‚¬κ²°μ •μ€ κ°μ •λ³΄λ‹¤ λ…Όλ¦¬κ°€ μ°μ„ μ΄λ‹¤", "T", "F"),
        ("μ‚¬λμ μ…μ¥μ„ λ¨Όμ € μƒκ°ν•λ” νΈμ΄λ‹¤", "F", "T"),
        ("λΉ„νμ  μ‚¬κ³ κ°€ μ¤‘μ”ν•λ‹¤κ³  μƒκ°ν•λ‹¤", "T", "F"),
        ("λ‹¤λ¥Έ μ‚¬λμ κ°μ •μ„ μ‰½κ² κ³µκ°ν•λ‹¤", "F", "T"),
        ("μ •μλ³΄λ‹¤λ” λ°°λ ¤κ°€ λ” μ¤‘μ”ν•λ‹¤", "F", "T"),
        ("κ°λ“± μƒν™©μ—μ„λ„ κ°μ •λ³΄λ‹¤λ” μ›μΉ™μ„ μ¤‘μ‹ν•λ‹¤", "T", "F"),
        ("μ‚¬λμ„ μ‹¤λ§μ‹ν‚¤λ” κ²ƒμ΄ μ‹«λ‹¤", "F", "T")
    ],
    "JP": [
        ("κ³„νν‘λ¥Ό μ§λ” κ²ƒμ„ μΆ‹μ•„ν•λ‹¤", "J", "P"),
        ("λ§κ° μ „μ— μΌμ„ λλ‚΄λ” νΈμ΄λ‹¤", "J", "P"),
        ("κ°‘μ‘μ¤λ¬μ΄ λ³€ν™”λ¥Ό μ¦κΈ°λ” νΈμ΄λ‹¤", "P", "J"),
        ("κ³„νμ΄ ν‹€μ–΄μ§€λ©΄ μ¤νΈλ μ¤λ¥Ό λ°›λ”λ‹¤", "J", "P"),
        ("μΌμ •μ„ μ λ™μ μΌλ΅ μ›€μ§μ΄λ” κ² νΈν•λ‹¤", "P", "J"),
        ("ν•΄μ•Ό ν•  μΌμ„ λ―Έλ¦¬ μ¤€λΉ„ν•λ‹¤", "J", "P"),
        ("κ³„νλ³΄λ‹¤ μ¦‰ν¥μ μΈ μ„ νƒμ΄ λ” μ λ§λ”λ‹¤", "P", "J")
    ]
}

# μ΄κΈ° μ μ μ„Έν…
scores = {"E": 0, "I": 0, "S": 0, "N": 0, "T": 0, "F": 0, "J": 0, "P": 0}

st.markdown("---")
st.subheader("π“ 28λ¬Έν•­μ— λ‹µν•΄μ£Όμ„Έμ”:")

# μ§λ¬Έ μμ„λ€λ΅ μ¶λ ¥
for dimension, q_list in questions.items():
    st.markdown(f"### {dimension} μ ν• μ§λ¬Έ")
    for idx, (q, opt1, opt2) in enumerate(q_list):
        choice = st.radio(f"{q}", [opt1, opt2], key=f"{dimension}-{idx}")
        scores[choice] += 1

# MBTI κ²°μ • ν•¨μ
def get_mbti(scores):
    return (
        "E" if scores["E"] >= scores["I"] else "I"
    ) + (
        "S" if scores["S"] >= scores["N"] else "N"
    ) + (
        "T" if scores["T"] >= scores["F"] else "F"
    ) + (
        "J" if scores["J"] >= scores["P"] else "P"
    )

# MBTI μ„¤λ…
mbti_desc = {
    "ISTJ": "μ‹ μ¤‘ν•κ³  μ±…μ„κ° μλ” κ΄€λ¦¬μ",
    "ISFJ": "μ΅°μ©ν•κ³  μ„±μ‹¤ν• λ³΄νΈμ",
    "INFJ": "ν†µμ°°λ ¥ μλ” μ΅°μ©ν• μ΄μƒμ£Όμμ",
    "INTJ": "λ…λ¦½μ μ΄κ³  μ „λµμ μΈ μ‚¬μƒ‰κ°€",
    "ISTP": "λ…Όλ¦¬μ μ΄κ³  μ‹¤μ©μ μΈ νƒν—κ°€",
    "ISFP": "μ΅°μ©ν•κ³  μΉμ ν• μμ κ°€",
    "INFP": "μ΄μƒμ μ΄κ³  μ¶©μ„±μ¤λ¬μ΄ μ¤‘μ¬μ",
    "INTP": "μ§€μ μ΄κ³  μ°½μμ μΈ μ‚¬μƒ‰κ°€",
    "ESTP": "ν™λ™μ μ΄κ³  μ—λ„μ§€ λ„μΉλ” ν•΄κ²°μ‚¬",
    "ESFP": "μ‚¬κµμ μ΄κ³  μμ λ΅μ΄ μ—°μμΈ",
    "ENFP": "μ—΄μ •μ μ΄κ³  μ°½μμ μΈ ν™λ™κ°€",
    "ENTP": "λ…Όμμ„ μ¦κΈ°λ” λ°λ…κ°€",
    "ESTJ": "μ²΄κ³„μ μ΄κ³  μ‹¤μ©μ μΈ κ΄€λ¦¬μ",
    "ESFJ": "λ‹¤μ •ν•κ³  ν—μ‹ μ μΈ μ΅°λ ¥μ",
    "ENFJ": "μ΄νƒ€μ μ΄κ³  μΉ΄λ¦¬μ¤λ§ μλ” λ¦¬λ”",
    "ENTJ": "λ‹¨νΈν•κ³  λ©ν‘μ§€ν–¥μ μΈ μ§€νκ΄€"
}

# κ²°κ³Ό μ¶λ ¥
if st.button("π” κ²°κ³Ό λ³΄κΈ°"):
    mbti_result = get_mbti(scores)
    st.success(f"β… λ‹Ήμ‹ μ MBTIλ” **{mbti_result}** μ…λ‹λ‹¤!")
    st.write(f"**{mbti_desc.get(mbti_result, 'μ„¤λ…μ΄ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.')}**")

    # κ²°κ³Ό μ €μ¥
    result = {
        "datetime": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "MBTI": mbti_result,
        **scores
    }
    df = pd.DataFrame([result])
    try:
        df.to_csv("mbti_results_full.csv", mode='a', index=False, header=not pd.io.common.file_exists("mbti_results_full.csv"))
        st.info("π“ κ²°κ³Όκ°€ 'mbti_results_full.csv' νμΌμ— μ €μ¥λμ—μµλ‹λ‹¤.")
    except:
        st.warning("β οΈ κ²°κ³Ό μ €μ¥ μ‹¤ν¨ - λ΅μ»¬ νμΌ κ¶ν•μ„ ν™•μΈν•΄μ£Όμ„Έμ”.")

    st.markdown("---")
    st.markdown("π” **ν…μ¤νΈλ¥Ό λ‹¤μ‹ ν•κ³  μ‹¶λ‹¤λ©΄ νμ΄μ§€λ¥Ό μƒλ΅κ³ μΉ¨ν•΄μ£Όμ„Έμ”.**")

