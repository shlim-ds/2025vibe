import streamlit as st
import random
import pandas as pd
from datetime import datetime

st.set_page_config(page_title="MBTI ν…μ¤νΈ", layout="centered")
st.title("π§  μ •λ°€ MBTI ν…μ¤νΈ (λλ¤ μ¶μ  + μ €μ¥ κΈ°λ¥)")

# μ§λ¬Έ λ°μ΄ν„° μ •μ
questions = {
    "EI": [
        ("μƒλ΅μ΄ μ‚¬λμ„ λ§λ‚λ” κ²ƒμ΄ μ¦κ²λ‹¤", "E", "I"),
        ("μ—¬λΏμ΄ μ–΄μΈλ¦¬λ” λ¨μ„μ—μ„ μ—λ„μ§€λ¥Ό μ–»λ”λ‹¤", "E", "I"),
        ("νΌμ μλ” μ‹κ°„μ΄ ν•„μ”ν•λ‹¤", "I", "E"),
        ("μ‚¬λλ“¤κ³Ό ν•¨κ» μμΌλ©΄ κΈ°λ¶„μ΄ μΆ‹μ•„μ§„λ‹¤", "E", "I"),
        ("νν‹°λ³΄λ‹¤λ” μ΅°μ©ν• μ‹κ°„μ„ μ„ νΈν•λ‹¤", "I", "E")
    ],
    "SN": [
        ("μ‚¬μ‹¤κ³Ό λ°μ΄ν„°λ¥Ό μ¤‘μ”ν•κ² μ—¬κΈ΄λ‹¤", "S", "N"),
        ("μ¶”μƒμ μΈ μ•„μ΄λ””μ–΄λ³΄λ‹¤ μ‹¤μ©μ μΈ κ²ƒμ΄ μΆ‹λ‹¤", "S", "N"),
        ("μƒμƒκ³Ό μκ°μ΄ μ¤‘μ”ν•λ‹¤κ³  μƒκ°ν•λ‹¤", "N", "S"),
        ("μ§κ΄€λ³΄λ‹¤λ” κ²½ν—μ„ μ‹ λΆ°ν•λ‹¤", "S", "N"),
        ("μ„Έλ¶€μ‚¬ν•­λ³΄λ‹¤λ” μ „μ²΄ νλ¦„μ— μ§‘μ¤‘ν•λ‹¤", "N", "S")
    ],
    "TF": [
        ("μμ‚¬κ²°μ • μ‹ λ…Όλ¦¬λ¥Ό μ°μ„ μ‹ν•λ‹¤", "T", "F"),
        ("μ‚¬λλ“¤μ κ°μ •μ„ κ³ λ ¤ν•΄ κ²°μ •μ„ λ‚΄λ¦°λ‹¤", "F", "T"),
        ("λΉ„νμ  μ‚¬κ³ λ¥Ό μ¤‘μ‹ν•λ‹¤", "T", "F"),
        ("κ³µκ° λ¥λ ¥μ΄ λ›°μ–΄λ‚λ‹¤λ” λ§μ„ λ“£λ”λ‹¤", "F", "T"),
        ("κ°κ΄€μ μΈ κΈ°μ¤€μΌλ΅ νλ‹¨ν•λ‹¤", "T", "F")
    ],
    "JP": [
        ("κ³„νμ μΌλ΅ μΌμ •μ„ κ΄€λ¦¬ν•λ‹¤", "J", "P"),
        ("μ μ—°ν• μΌμ •κ³Ό μ¦‰ν¥μ μΈ κ³„νμ„ μ„ νΈν•λ‹¤", "P", "J"),
        ("μ²΄κ³„μ μΌλ΅ μΌ μ²λ¦¬λ¥Ό ν•λ‹¤", "J", "P"),
        ("μ¦‰ν¥μ μΈ μƒν™©μ—μ„ μ λ€μ²ν•λ‹¤", "P", "J"),
        ("μΌμ„ ν•κΈ° μ „ λ―Έλ¦¬ μ •λ¦¬ν•λ‹¤", "J", "P")
    ]
}

# λλ¤ν•κ² κ° μ°¨μ›μ—μ„ 3λ¬Έν•­ μ„ νƒ
selected_questions = {}
for key, qlist in questions.items():
    selected_questions[key] = random.sample(qlist, 3)

# μ μ κΈ°λ΅
scores = {"E": 0, "I": 0, "S": 0, "N": 0, "T": 0, "F": 0, "J": 0, "P": 0}

# μ§λ¬Έ ν‘μ‹
st.markdown("---")
st.subheader("π“ μ§λ¬Έμ— λ‹µν•΄μ£Όμ„Έμ”:")
for dim, qlist in selected_questions.items():
    for idx, (q, a1, a2) in enumerate(qlist):
        choice = st.radio(f"{q}", [a1, a2], key=f"{dim}-{idx}")
        scores[choice] += 1

# MBTI μ ν• κ²°μ •
def determine_mbti(scores):
    result = ""
    result += "E" if scores["E"] >= scores["I"] else "I"
    result += "S" if scores["S"] >= scores["N"] else "N"
    result += "T" if scores["T"] >= scores["F"] else "F"
    result += "J" if scores["J"] >= scores["P"] else "P"
    return result

# μ„¤λ… μ‚¬μ „
mbti_desc = {
    "ISTJ": "μ‹ μ¤‘ν•κ³  μ±…μ„κ° μλ” κ΄€λ¦¬μ",
    "ISFJ": "μ΅°μ©ν•κ³  μ„±μ‹¤ν• λ³΄νΈμ",
    "INFJ": "ν†µμ°°λ ¥ μλ” μ΅°μ©ν• μ΄μƒμ£Όμμ",
    "INTJ": "λ…λ¦½μ μ΄κ³  μ „λµμ μΈ μ‚¬μƒ‰κ°€",
    "ISTP": "λ…Όλ¦¬μ μ΄κ³  μ‹¤μ©μ μΈ νƒν—κ°€",
    "ISFP": "μ΅°μ©ν•κ³  μΉμ ν• μμ κ°€",
    "INFP": "μ΄μƒμ μ΄κ³  μ¶©μ„±μ¤λ¬μ΄ μ¤‘μ¬μ",
    "INTP": "μ§€μ μ΄κ³  μ°½μμ μΈ μ‚¬μƒ‰κ°€",
    "ESTP": "ν™λ™μ μ΄κ³  μ—λ„μ§€ λ„μΉλ” ν•΄κ²°μ‚¬",
    "ESFP": "μ‚¬κµμ μ΄κ³  μμ λ΅μ΄ μ—°μμΈ",
    "ENFP": "μ—΄μ •μ μ΄κ³  μ°½μμ μΈ ν™λ™κ°€",
    "ENTP": "λ…Όμμ„ μ¦κΈ°λ” λ°λ…κ°€",
    "ESTJ": "μ²΄κ³„μ μ΄κ³  μ‹¤μ©μ μΈ κ΄€λ¦¬μ",
    "ESFJ": "λ‹¤μ •ν•κ³  ν—μ‹ μ μΈ μ΅°λ ¥μ",
    "ENFJ": "μ΄νƒ€μ μ΄κ³  μΉ΄λ¦¬μ¤λ§ μλ” λ¦¬λ”",
    "ENTJ": "λ‹¨νΈν•κ³  λ©ν‘μ§€ν–¥μ μΈ μ§€νκ΄€"
}

# κ²°κ³Ό λ²„νΌ
if st.button("π” MBTI κ²°κ³Ό ν™•μΈ"):
    mbti_type = determine_mbti(scores)
    st.success(f"λ‹Ήμ‹ μ MBTIλ” **{mbti_type}** μ…λ‹λ‹¤!")
    st.markdown(f"**{mbti_desc.get(mbti_type, 'μ„¤λ…μ΄ μ¤€λΉ„ μ¤‘μ…λ‹λ‹¤.')}**")

    # κ²°κ³Ό μ €μ¥
    result = {
        "datetime": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "MBTI": mbti_type,
        **scores
    }
    df = pd.DataFrame([result])
    try:
        df.to_csv("mbti_results.csv", mode='a', index=False, header=False)
        st.info("β… κ²°κ³Όκ°€ `mbti_results.csv` νμΌμ— μ €μ¥λμ—μµλ‹λ‹¤.")
    except:
        st.warning("β οΈ κ²°κ³Ό μ €μ¥μ— μ‹¤ν¨ν–μµλ‹λ‹¤. λ΅μ»¬ κ¶ν•μ„ ν™•μΈν•μ„Έμ”.")

    # λ‹¤μ‹ν•κΈ°
    st.markdown("---")
    st.markdown("π” ν…μ¤νΈλ¥Ό λ‹¤μ‹ ν•κ³  μ‹¶λ‹¤λ©΄ μ•±μ„ μƒλ΅κ³ μΉ¨ ν•΄μ£Όμ„Έμ” (F5 λλ” β³ λ²„νΌ).")

